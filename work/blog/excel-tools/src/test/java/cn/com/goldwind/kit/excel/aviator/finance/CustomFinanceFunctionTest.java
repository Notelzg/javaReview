/**
 * Copyright 2017 Goldwind Science & Technology. All rights reserved. GOLDWIND
 * PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
 */

package cn.com.goldwind.kit.excel.aviator.finance;

import cn.com.goldwind.kit.excel.aviator.function.finance.*;
import cn.com.goldwind.springboot.framework.kit.JsonKit;
import com.googlecode.aviator.AviatorEvaluator;
import org.junit.BeforeClass;
import org.junit.Test;

import java.util.HashMap;
import java.util.Map;

import static org.junit.Assert.assertEquals;

/**
 * @author lfjin
 *
 */
public class CustomFinanceFunctionTest {
    @BeforeClass
    public static void setup() {

        AviatorEvaluator.addFunction(new IRRFunction());
        AviatorEvaluator.addFunction(new NPVFunction());
        AviatorEvaluator.addFunction(new PPMTFunction());
        AviatorEvaluator.addFunction(new PMTFunction());
        AviatorEvaluator.addFunction(new XIRRFunction());
        AviatorEvaluator.addFunction(new XNPVFunction());
    }

    @Test
    public void testIRR() {
        String exp1 = "finance.irr(a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13,a14,a15,a16,a17,a18,a19,a20,a21)";
        double[] income = {-36535f, 5167f, 8155f, 6661f, 6661f, 6515f, 6125f, 6107f, 6089f, 6071f, 6053f, 6036f, 6036f,
                6036f, 6036f, 6036f, 6036f, 6036f, 6036f, 6036f, 7674f};
        // double rtn = Irr.irr(income);
        assertEquals(0.1663892437930055f,
                     AviatorEvaluator.exec(exp1, income[0], income[1], income[2], income[3], income[4], income[5],
                                           income[6], income[7], income[8], income[9], income[10], income[11],
                                           income[12], income[13], income[14], income[15], income[16], income[17],
                                           income[18], income[19], income[20]));
    }

    @Test
    public void testNPV() {
        String exp1 = "finance.npv(r, a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13,a14,a15,a16,a17,a18,a19,a20,a21)";
        double r = 0.0815816235434866;
        double[] cfs = {-36535, 5167, 8155, 6661, 6661, 6515, 6125, 6107, 6089, 6071, 6053, 6036, 6036, 6036, 6036,
                6036, 6036, 6036, 6036, 6036, 7674};
        assertEquals(22938.406496416934f,
                     AviatorEvaluator.exec(exp1, r, cfs[0], cfs[1], cfs[2], cfs[3], cfs[4], cfs[5], cfs[6], cfs[7],
                                           cfs[8], cfs[9], cfs[10], cfs[11], cfs[12], cfs[13], cfs[14], cfs[15],
                                           cfs[16], cfs[17], cfs[18], cfs[19], cfs[20]));
        cfs = new double[] {-36534.7824, 5167.25, 8154.75, 6661, 6661, 6515.064328, 6124.9294, 6106.826419, 6088.723438,
                6070.620457, 6052.517476, 6035.923077, 6035.923077, 6035.923077, 6035.923077, 6035.923077, 6035.923077,
                6035.923077, 6035.923077, 6035.923077, 7674.089479};

        assertEquals(22937.832858099577f,
                     AviatorEvaluator.exec(exp1, r, cfs[0], cfs[1], cfs[2], cfs[3], cfs[4], cfs[5], cfs[6], cfs[7],
                                           cfs[8], cfs[9], cfs[10], cfs[11], cfs[12], cfs[13], cfs[14], cfs[15],
                                           cfs[16], cfs[17], cfs[18], cfs[19], cfs[20]));

    }

    @Test
    public void testPPMT() {
        String exp1 = "finance.ppmt(rate, per, nper, pv)";
        assertEquals(-756.2318600836630, AviatorEvaluator.exec(exp1, 0.10 / 12, 1, 2 * 12, 20000.00));
        assertEquals(-275980.5346242140, AviatorEvaluator.exec(exp1, 0.08, 10, 10, 2000000.00));
    }

    @Test
    public void testPMT() {
        String exp1 = "finance.pmt(rate, nper, pv)";
        assertEquals(-10370.30, AviatorEvaluator.exec(exp1, 0.08 / 12, 10, 100000));
        exp1 = "finance.pmt(rate, nper, pv, fv)";
        assertEquals(-1290.80, AviatorEvaluator.exec(exp1, 0.06 / 12, 18*12,0.0 , 500000));
    }

    @Test
    public void testXIRR() {
        String exp = "finance.xirr(a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)";

        // assertEquals(0.373362535238266, AviatorEvaluator.exec(exp, -10000,
        // 2750, 4250, 3250, 2750, "2008-1-1",
        // "2008-3-1", "2008-10-30", "2009-2-15", "2009-4-1"));
        exp = "finance.xirr(a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12)";

        // assertEquals(0.373362535238266,
        // AviatorEvaluator.exec(exp, -10000, 2750, 4250, 3250, 2750, 0,
        // "2008-01-01", "2008-03-01",
        // "2008-10-30", "2009-02-15", "2009-04-01", "2009-05-01"));

        exp = "finance.xirr(附表5_D102,附表5_E102,附表5_F102,附表5_G102,附表5_H102,附表5_I102,附表5_J102,附表5_K102,附表5_L102,附表5_M102,附表5_N102,附表5_O102,附表5_P102,附表5_Q102,附表5_R102,附表5_S102,附表5_T102,附表5_U102,附表5_V102,附表5_W102,附表5_X102,附表5_Y102,附表5_Z102,附表5_AA102,附表5_AB102,附表5_AC102,附表5_AD102,附表5_AE102,附表5_AF102,附表5_AG102,附表5_AH102,附表5_AI102,附表5_AJ102,附表5_AK102,附表5_AL102,附表5_AM102,附表5_AN102,附表5_AO102,附表5_AP102,附表5_AQ102,附表5_AR102,附表5_AS102,附表5_AT102,附表5_AU102,附表5_AV102,附表5_AW102,附表5_AX102,附表5_AY102,附表5_AZ102,附表5_BA102,附表5_BB102,附表5_BC102,附表5_BD102,附表5_BE102,附表5_BF102,附表5_BG102,附表5_BH102,附表5_BI102,附表5_BJ102,附表5_BK102,附表5_BL102,附表5_BM102,附表5_BN102,附表5_BO102,附表5_BP102,附表5_BQ102,附表5_BR102,附表5_BS102,附表5_BT102,附表5_BU102,附表5_BV102,附表5_BW102,附表5_BX102,附表5_BY102,附表5_BZ102,附表5_CA102,附表5_CB102,附表5_CC102,附表5_CD102,附表5_CE102,附表5_CF102,附表5_CG102,附表5_CH102,附表5_CI102,附表5_CJ102,附表5_CK102,附表5_CL102,附表5_CM102,附表5_CN102,附表5_CO102,附表5_CP102,附表5_CQ102,附表5_CR102,附表5_CS102,附表5_CT102,附表5_CU102,附表5_CV102,附表5_CW102,附表5_CX102,附表5_CY102,附表5_CZ102,附表5_DA102,附表5_DB102,附表5_DC102,附表5_DD102,附表5_DE102,附表5_DF102,附表5_DG102,附表5_DH102,附表5_DI102,附表5_DJ102,附表5_DK102,附表5_DL102,附表5_DM102,附表5_DN102,附表5_DO102,附表5_DP102,附表5_DQ102,附表5_DR102,附表5_DS102,附表5_DT102,附表5_DU102,附表5_DV102,附表5_DW102,附表5_DX102,附表5_DY102,附表5_DZ102,附表5_EA102,附表5_EB102,附表5_EC102,附表5_ED102,附表5_EE102,附表5_EF102,附表5_EG102,附表5_EH102,附表5_EI102,附表5_EJ102,附表5_EK102,附表5_EL102,附表5_EM102,附表5_EN102,附表5_D90,附表5_E90,附表5_F90,附表5_G90,附表5_H90,附表5_I90,附表5_J90,附表5_K90,附表5_L90,附表5_M90,附表5_N90,附表5_O90,附表5_P90,附表5_Q90,附表5_R90,附表5_S90,附表5_T90,附表5_U90,附表5_V90,附表5_W90,附表5_X90,附表5_Y90,附表5_Z90,附表5_AA90,附表5_AB90,附表5_AC90,附表5_AD90,附表5_AE90,附表5_AF90,附表5_AG90,附表5_AH90,附表5_AI90,附表5_AJ90,附表5_AK90,附表5_AL90,附表5_AM90,附表5_AN90,附表5_AO90,附表5_AP90,附表5_AQ90,附表5_AR90,附表5_AS90,附表5_AT90,附表5_AU90,附表5_AV90,附表5_AW90,附表5_AX90,附表5_AY90,附表5_AZ90,附表5_BA90,附表5_BB90,附表5_BC90,附表5_BD90,附表5_BE90,附表5_BF90,附表5_BG90,附表5_BH90,附表5_BI90,附表5_BJ90,附表5_BK90,附表5_BL90,附表5_BM90,附表5_BN90,附表5_BO90,附表5_BP90,附表5_BQ90,附表5_BR90,附表5_BS90,附表5_BT90,附表5_BU90,附表5_BV90,附表5_BW90,附表5_BX90,附表5_BY90,附表5_BZ90,附表5_CA90,附表5_CB90,附表5_CC90,附表5_CD90,附表5_CE90,附表5_CF90,附表5_CG90,附表5_CH90,附表5_CI90,附表5_CJ90,附表5_CK90,附表5_CL90,附表5_CM90,附表5_CN90,附表5_CO90,附表5_CP90,附表5_CQ90,附表5_CR90,附表5_CS90,附表5_CT90,附表5_CU90,附表5_CV90,附表5_CW90,附表5_CX90,附表5_CY90,附表5_CZ90,附表5_DA90,附表5_DB90,附表5_DC90,附表5_DD90,附表5_DE90,附表5_DF90,附表5_DG90,附表5_DH90,附表5_DI90,附表5_DJ90,附表5_DK90,附表5_DL90,附表5_DM90,附表5_DN90,附表5_DO90,附表5_DP90,附表5_DQ90,附表5_DR90,附表5_DS90,附表5_DT90,附表5_DU90,附表5_DV90,附表5_DW90,附表5_DX90,附表5_DY90,附表5_DZ90,附表5_EA90,附表5_EB90,附表5_EC90,附表5_ED90,附表5_EE90,附表5_EF90,附表5_EG90,附表5_EH90,附表5_EI90,附表5_EJ90,附表5_EK90,附表5_EL90,附表5_EM90,附表5_EN90)";
        String values = "{\"附表5_EL102\":0.0,\"附表5_AF102\":800.6922496977903,\"附表5_CK90\":\"2039-06-30\",\"附表5_EN90\":\"2053-03-31\",\"附表5_DE102\":475.6243563832018,\"附表5_DP102\":441.7550508761902,\"附表5_AH90\":\"2025-09-30\",\"附表5_CC90\":\"2037-06-30\",\"附表5_BM102\":771.4297087969222,\"附表5_EF90\":\"2051-03-31\",\"附表5_CT102\":506.67995469873995,\"附表5_EA102\":0.0,\"附表5_AP90\":\"2027-09-30\",\"附表5_E102\":0,\"附表5_BB102\":702.7802042217307,\"附表5_AX90\":\"2029-09-30\",\"附表5_U102\":987.9441970077545,\"附表5_AQ102\":4955.182953122135,\"附表5_CS90\":\"2041-06-30\",\"附表5_DU102\":421.8859415190086,\"附表5_BB90\":\"2030-09-30\",\"附表5_AA102\":3929.7997205150855,\"附表5_DM90\":\"2046-06-30\",\"附表5_CY102\":490.5355164479515,\"附表5_BJ90\":\"2032-09-30\",\"附表5_BH102\":777.0749009827427,\"附表5_DE90\":\"2044-06-30\",\"附表5_J90\":\"2019-09-30\",\"附表5_BR90\":\"2034-09-30\",\"附表5_Z102\":960.6226746102751,\"附表5_BX102\":766.2812408151326,\"附表5_BZ90\":\"2036-09-30\",\"附表5_EF102\":0.0,\"附表5_R90\":\"2021-09-30\",\"附表5_J102\":972.3793836699183,\"附表5_AL102\":755.4086191714156,\"附表5_CI102\":1522.1928515684053,\"附表5_DU90\":\"2048-06-30\",\"附表5_Z90\":\"2023-09-30\",\"附表5_AA90\":\"2023-12-31\",\"附表5_BS102\":1528.1442581971453,\"附表5_AW102\":739.4160530444212,\"附表5_DV102\":418.0613066642628,\"附表5_CL90\":\"2039-09-30\",\"附表5_CZ102\":491.1514251889444,\"附表5_AI90\":\"2025-12-31\",\"附表5_CD90\":\"2037-09-30\",\"附表5_EG90\":\"2051-06-30\",\"附表5_AQ90\":\"2027-12-31\",\"附表5_AY90\":\"2029-12-31\",\"附表5_AG102\":795.1757324576498,\"附表5_CD102\":763.1851365414541,\"附表5_CT90\":\"2041-09-30\",\"附表5_O102\":4799.631741429957,\"附表5_CJ102\":531.9221053720893,\"附表5_EG102\":0.0,\"附表5_BC90\":\"2030-12-31\",\"附表5_T102\":990.6855186392528,\"附表5_DN90\":\"2046-09-30\",\"附表5_BK90\":\"2032-12-31\",\"附表5_BN102\":769.0027933429037,\"附表5_DK102\":458.5630948030173,\"附表5_DF90\":\"2044-09-30\",\"附表5_I90\":\"2019-06-30\",\"附表5_BC102\":4910.327725052743,\"附表5_D102\":-12200.0,\"附表5_Q90\":\"2021-06-30\",\"附表5_AR102\":754.5620485955059,\"附表5_CO102\":517.2822814495472,\"附表5_BS90\":\"2034-12-31\",\"附表5_DV90\":\"2048-09-30\",\"附表5_AB90\":\"2024-03-31\",\"附表5_EH90\":\"2051-09-30\",\"附表5_DA102\":488.4232538340371,\"附表5_AB102\":802.3256789172067,\"附表5_CM90\":\"2039-12-31\",\"附表5_AJ90\":\"2026-03-31\",\"附表5_BI102\":774.8610074339215,\"附表5_DL102\":453.7570963393934,\"附表5_CE90\":\"2037-12-31\",\"附表5_AR90\":\"2028-03-31\",\"附表5_I102\":871.3317706451138,\"附表5_BY102\":765.0383808956205,\"附表5_Y102\":992.9837169469712,\"附表5_AZ90\":\"2030-03-31\",\"附表5_CP102\":514.9887957150248,\"附表5_AM102\":4962.150635698652,\"附表5_CU90\":\"2041-12-31\",\"附表5_BD90\":\"2031-03-31\",\"附表5_DG90\":\"2044-12-31\",\"附表5_AX102\":731.9361943636662,\"附表5_EM102\":0.0,\"附表5_BL90\":\"2033-03-31\",\"附表5_BT102\":768.0077868567391,\"附表5_DQ102\":438.24061612690014,\"附表5_DF102\":472.64273555718063,\"附表5_D90\":\"2018-04-30\",\"附表5_DW90\":\"2048-12-31\",\"附表5_EB102\":0.0,\"附表5_CU102\":504.2078231008833,\"附表5_L90\":\"2020-03-31\",\"附表5_DO90\":\"2046-12-31\",\"附表5_AH102\":789.6283068367832,\"附表5_CE102\":1525.5369079073168,\"附表5_T90\":\"2022-03-31\",\"附表5_N102\":971.8201751142049,\"附表5_BT90\":\"2035-03-31\",\"附表5_AC90\":\"2024-06-30\",\"附表5_CF90\":\"2038-03-31\",\"附表5_EI90\":\"2051-12-31\",\"附表5_S102\":4042.632952713409,\"附表5_EN102\":0.0,\"附表5_DR102\":434.6715441214376,\"附表5_AK90\":\"2026-06-30\",\"附表5_EA90\":\"2049-12-31\",\"附表5_DG102\":469.6132844444888,\"附表5_BO102\":1530.302157144283,\"附表5_AS90\":\"2028-06-30\",\"附表5_CV90\":\"2042-03-31\",\"附表5_BD102\":783.4713747282373,\"附表5_CV102\":498.496911572602,\"附表5_CN90\":\"2040-03-31\",\"附表5_AS102\":747.2557484633828,\"附表5_EC102\":0.0,\"附表5_AC102\":798.333949352501,\"附表5_DH90\":\"2045-03-31\",\"附表5_DW102\":2202.1780990617654,\"附表5_BJ102\":772.5986525002028,\"附表5_BE90\":\"2031-06-30\",\"附表5_BU90\":\"2035-06-30\",\"附表5_DX90\":\"2049-03-31\",\"附表5_H102\":970.2847772981627,\"附表5_BZ102\":763.7630824200022,\"附表5_K90\":\"2019-12-31\",\"附表5_BM90\":\"2033-06-30\",\"附表5_X102\":995.7441622745931,\"附表5_DP90\":\"2047-03-31\",\"附表5_AN102\":762.9869377089822,\"附表5_CK102\":528.9505204753555,\"附表5_EH102\":0.0,\"附表5_S90\":\"2021-12-31\",\"附表5_AY102\":4938.859091982051,\"附表5_CG90\":\"2038-06-30\",\"附表5_W90\":\"2022-12-31\",\"附表5_EJ90\":\"2052-03-31\",\"附表5_DX102\":0.0,\"附表5_BU102\":766.906418413909,\"附表5_EB90\":\"2050-03-31\",\"附表5_AD90\":\"2024-09-30\",\"附表5_CW90\":\"2042-06-30\",\"附表5_AL90\":\"2026-09-30\",\"附表5_M102\":972.8400008581027,\"附表5_AI102\":3847.82724999619,\"附表5_CO90\":\"2040-06-30\",\"附表5_EI102\":0.0,\"附表5_CL102\":525.9414479895465,\"附表5_AT90\":\"2028-09-30\",\"附表5_R102\":981.5867720159598,\"附表5_BP102\":767.4471521643936,\"附表5_CF102\":763.065169116127,\"附表5_DI90\":\"2045-06-30\",\"附表5_DA90\":\"2043-06-30\",\"附表5_DB102\":485.65047823093977,\"附表5_F90\":\"2018-09-30\",\"附表5_DM102\":450.42757063468923,\"附表5_BF90\":\"2031-09-30\",\"附表5_BV90\":\"2035-09-30\",\"附表5_CQ102\":512.6562823137847,\"附表5_DY90\":\"2049-06-30\",\"附表5_BE102\":781.4771382226315,\"附表5_N90\":\"2020-09-30\",\"附表5_BN90\":\"2033-09-30\",\"附表5_AT102\":739.9118514399198,\"附表5_CA102\":1526.2326606244135,\"附表5_DQ90\":\"2047-06-30\",\"附表5_V90\":\"2022-09-30\",\"附表5_AD102\":794.3313243243966,\"附表5_CG102\":761.5511393100032,\"附表5_CH90\":\"2038-09-30\",\"附表5_EK90\":\"2052-06-30\",\"附表5_BK102\":1534.0648917007625,\"附表5_DC102\":482.83252815113144,\"附表5_DN102\":447.0457767151414,\"附表5_EC90\":\"2050-06-30\",\"附表5_AE90\":\"2024-12-31\",\"附表5_CX90\":\"2042-09-30\",\"附表5_G102\":-16200.0,\"附表5_CR102\":511.5023178684889,\"附表5_AM90\":\"2026-12-31\",\"附表5_CP90\":\"2040-09-30\",\"附表5_W102\":4046.2169628886004,\"附表5_AU90\":\"2028-12-31\",\"附表5_AO102\":755.8286342253975,\"附表5_AZ102\":715.1097422743164,\"附表5_DS102\":431.0471389632653,\"附表5_DJ90\":\"2045-09-30\",\"附表5_BV102\":765.7743792237122,\"附表5_DB90\":\"2043-09-30\",\"附表5_E90\":\"2018-06-30\",\"附表5_BG90\":\"2031-12-31\",\"附表5_DH102\":468.0159725833877,\"附表5_BW90\":\"2035-12-31\",\"附表5_DZ90\":\"2049-09-30\",\"附表5_M90\":\"2020-06-30\",\"附表5_BO90\":\"2033-12-31\",\"附表5_CW102\":495.88636759518533,\"附表5_L102\":974.4764699096968,\"附表5_AJ102\":769.3788167028164,\"附表5_DR90\":\"2047-09-30\",\"附表5_ED102\":0.0,\"附表5_U90\":\"2022-06-30\",\"附表5_BQ102\":766.4497675827537,\"附表5_DT102\":425.6527394997093,\"附表5_Y90\":\"2023-06-30\",\"附表5_CI90\":\"2038-12-31\",\"附表5_EL90\":\"2052-09-30\",\"附表5_CA90\":\"2036-12-31\",\"附表5_AF90\":\"2025-03-31\",\"附表5_ED90\":\"2050-09-30\",\"附表5_DI102\":464.91459448377566,\"附表5_BF102\":779.4374103621972,\"附表5_CY90\":\"2042-12-31\",\"附表5_AN90\":\"2027-03-31\",\"附表5_CB102\":765.934543557642,\"附表5_CX102\":493.23275283456087,\"附表5_AU102\":4946.307552420758,\"附表5_CQ90\":\"2040-12-31\",\"附表5_AV90\":\"2029-03-31\",\"附表5_Q102\":984.3114104011275,\"附表5_EE102\":0.0,\"附表5_AE102\":3854.095333685155,\"附表5_DK90\":\"2045-12-31\",\"附表5_DY102\":0.0,\"附表5_BA102\":708.9665858607452,\"附表5_BH90\":\"2032-03-31\",\"附表5_DC90\":\"2043-12-31\",\"附表5_BL102\":773.8058803267262,\"附表5_F102\":-12000.0,\"附表5_H90\":\"2019-03-31\",\"附表5_BX90\":\"2036-03-31\",\"附表5_BP90\":\"2034-03-31\",\"附表5_CM102\":522.8944193197988,\"附表5_P90\":\"2021-03-31\",\"附表5_V102\":985.1954931857845,\"附表5_DS90\":\"2047-12-31\",\"附表5_AP102\":748.6348978396072,\"附表5_EJ102\":0.0,\"附表5_X90\":\"2023-03-31\",\"附表5_CJ90\":\"2039-03-31\",\"附表5_EM90\":\"2052-12-31\",\"附表5_BW102\":1528.3890065745463,\"附表5_AG90\":\"2025-06-30\",\"附表5_CB90\":\"2037-03-31\",\"附表5_EE90\":\"2050-12-31\",\"附表5_DJ102\":461.7638452043978,\"附表5_AO90\":\"2027-06-30\",\"附表5_CZ90\":\"2043-03-31\",\"附表5_DZ102\":0.0,\"附表5_CN102\":519.5372336180917,\"附表5_AW90\":\"2029-06-30\",\"附表5_CR90\":\"2041-03-31\",\"附表5_K102\":773.4276166616977,\"附表5_AK102\":762.4104296303112,\"附表5_CH102\":760.0012758604939,\"附表5_EK102\":0.0,\"附表5_BR102\":765.4230183745274,\"附表5_BA90\":\"2030-06-30\",\"附表5_DL90\":\"2046-03-31\",\"附表5_DD102\":478.5587499342089,\"附表5_DO102\":443.611048436617,\"附表5_BI90\":\"2032-06-30\",\"附表5_DD90\":\"2044-03-31\",\"附表5_BG102\":1541.1292871916917,\"附表5_CS102\":509.11128089960545,\"附表5_G90\":\"2018-12-31\",\"附表5_BQ90\":\"2034-06-30\",\"附表5_BY90\":\"2036-06-30\",\"附表5_AV102\":746.856312842066,\"附表5_CC102\":764.5767808089938,\"附表5_O90\":\"2020-12-31\",\"附表5_P102\":987.0293023163625,\"附表5_DT90\":\"2048-03-31\"},";

        Map env = new HashMap();
        env = JsonKit.parse(values, Map.class);
//        System.out.println(AviatorEvaluator.execute(exp, env));

        exp = "finance.xirr(附表6_B15,附表6_C15,附表6_D15,附表6_E15,附表6_F15,附表6_G15,附表6_H15,附表6_I15,附表6_J15,附表6_K15,附表6_L15,附表6_M15,附表6_N15,附表6_O15,附表6_P15,附表6_Q15,附表6_R15,附表6_S15,附表6_T15,附表6_U15,附表6_V15,附表6_W15,附表6_X15,附表6_Y15,附表6_Z15,附表6_AA15,附表6_AB15,附表6_AC15,附表6_AD15,附表6_AE15,附表6_AF15,附表6_AG15,附表6_AH15,附表6_AI15,附表6_AJ15,附表6_AK15,附表6_AL15,附表6_AM15,附表6_AN15,附表6_AO15,附表6_AP15,附表6_AQ15,附表6_AR15,附表6_AS15,附表6_AT15,附表6_AU15,附表6_AV15,附表6_AW15,附表6_AX15,附表6_AY15,附表6_AZ15,附表6_BA15,附表6_BB15,附表6_BC15,附表6_BD15,附表6_BE15,附表6_BF15,附表6_BG15,附表6_BH15,附表6_BI15,附表6_BJ15,附表6_BK15,附表6_BL15,附表6_BM15,附表6_BN15,附表6_BO15,附表6_BP15,附表6_BQ15,附表6_BR15,附表6_BS15,附表6_BT15,附表6_BU15,附表6_BV15,附表6_BW15,附表6_BX15,附表6_BY15,附表6_BZ15,附表6_CA15,附表6_CB15,附表6_CC15,附表6_CD15,附表6_CE15,附表6_CF15,附表6_CG15,附表6_CH15,附表6_CI15,附表6_CJ15,附表6_CK15,附表6_CL15,附表6_CM15,附表6_CN15,附表6_CO15,附表6_CP15,附表6_CQ15,附表6_CR15,附表6_CS15,附表6_CT15,附表6_CU15,附表6_CV15,附表6_CW15,附表6_CX15,附表6_CY15,附表6_CZ15,附表6_DA15,附表6_DB15,附表6_DC15,附表6_DD15,附表6_DE15,附表6_DF15,附表6_DG15,附表6_DH15,附表6_DI15,附表6_DJ15,附表6_DK15,附表6_DL15,附表6_DM15,附表6_DN15,附表6_DO15,附表6_DP15,附表6_DQ15,附表6_DR15,附表6_DS15,附表6_DT15,附表6_DU15,附表6_DV15,附表6_DW15,附表6_DX15,附表6_DY15,附表6_DZ15,附表6_EA15,附表6_EB15,附表6_EC15,附表6_ED15,附表6_EE15,附表6_EF15,附表6_EG15,附表6_EH15,附表6_EI15,附表6_EJ15,附表6_EK15,附表6_B14,附表6_C14,附表6_D14,附表6_E14,附表6_F14,附表6_G14,附表6_H14,附表6_I14,附表6_J14,附表6_K14,附表6_L14,附表6_M14,附表6_N14,附表6_O14,附表6_P14,附表6_Q14,附表6_R14,附表6_S14,附表6_T14,附表6_U14,附表6_V14,附表6_W14,附表6_X14,附表6_Y14,附表6_Z14,附表6_AA14,附表6_AB14,附表6_AC14,附表6_AD14,附表6_AE14,附表6_AF14,附表6_AG14,附表6_AH14,附表6_AI14,附表6_AJ14,附表6_AK14,附表6_AL14,附表6_AM14,附表6_AN14,附表6_AO14,附表6_AP14,附表6_AQ14,附表6_AR14,附表6_AS14,附表6_AT14,附表6_AU14,附表6_AV14,附表6_AW14,附表6_AX14,附表6_AY14,附表6_AZ14,附表6_BA14,附表6_BB14,附表6_BC14,附表6_BD14,附表6_BE14,附表6_BF14,附表6_BG14,附表6_BH14,附表6_BI14,附表6_BJ14,附表6_BK14,附表6_BL14,附表6_BM14,附表6_BN14,附表6_BO14,附表6_BP14,附表6_BQ14,附表6_BR14,附表6_BS14,附表6_BT14,附表6_BU14,附表6_BV14,附表6_BW14,附表6_BX14,附表6_BY14,附表6_BZ14,附表6_CA14,附表6_CB14,附表6_CC14,附表6_CD14,附表6_CE14,附表6_CF14,附表6_CG14,附表6_CH14,附表6_CI14,附表6_CJ14,附表6_CK14,附表6_CL14,附表6_CM14,附表6_CN14,附表6_CO14,附表6_CP14,附表6_CQ14,附表6_CR14,附表6_CS14,附表6_CT14,附表6_CU14,附表6_CV14,附表6_CW14,附表6_CX14,附表6_CY14,附表6_CZ14,附表6_DA14,附表6_DB14,附表6_DC14,附表6_DD14,附表6_DE14,附表6_DF14,附表6_DG14,附表6_DH14,附表6_DI14,附表6_DJ14,附表6_DK14,附表6_DL14,附表6_DM14,附表6_DN14,附表6_DO14,附表6_DP14,附表6_DQ14,附表6_DR14,附表6_DS14,附表6_DT14,附表6_DU14,附表6_DV14,附表6_DW14,附表6_DX14,附表6_DY14,附表6_DZ14,附表6_EA14,附表6_EB14,附表6_EC14,附表6_ED14,附表6_EE14,附表6_EF14,附表6_EG14,附表6_EH14,附表6_EI14,附表6_EJ14,附表6_EK14)";
        values = "{\"附表6_AP14\":\"2028-06-30\",\"附表6_AH15\":0,\"附表6_CK15\":0,\"附表6_CK14\":\"2040-03-31\",\"附表6_AH14\":\"2026-06-30\",\"附表6_CC15\":0,\"附表6_EF15\":0,\"附表6_CC14\":\"2038-03-31\",\"附表6_EF14\":\"2051-12-31\",\"附表6_M14\":\"2021-03-31\",\"附表6_BZ14\":\"2037-06-30\",\"附表6_M15\":14.840733280546033,\"附表6_BZ15\":0,\"附表6_U14\":\"2023-03-31\",\"附表6_BR14\":\"2035-06-30\",\"附表6_DU14\":\"2049-03-31\",\"附表6_U15\":79.55559323877662,\"附表6_BR15\":0,\"附表6_DU15\":0,\"附表6_BQ14\":\"2035-03-31\",\"附表6_BI15\":0,\"附表6_DL15\":0,\"附表6_DL14\":\"2046-12-31\",\"附表6_D15\":-4999.999999999999,\"附表6_D14\":\"2018-12-31\",\"附表6_BI14\":\"2033-03-31\",\"附表6_BA15\":0,\"附表6_DD15\":0,\"附表6_DD14\":\"2044-12-31\",\"附表6_BA14\":\"2031-03-31\",\"附表6_AX15\":0,\"附表6_AX14\":\"2030-06-30\",\"附表6_AP15\":0,\"附表6_CS15\":0,\"附表6_CS14\":\"2042-03-31\",\"附表6_AO14\":\"2028-03-31\",\"附表6_CR14\":\"2041-12-31\",\"附表6_AO15\":0,\"附表6_CJ15\":0,\"附表6_AG14\":\"2026-03-31\",\"附表6_CJ14\":\"2039-12-31\",\"附表6_AG15\":0,\"附表6_CB15\":0,\"附表6_EE14\":\"2051-09-30\",\"附表6_EE15\":0,\"附表6_L15\":3604.4984943052796,\"附表6_CB14\":\"2037-12-31\",\"附表6_L14\":\"2020-12-31\",\"附表6_BY15\":0,\"附表6_T15\":3123.0283938527837,\"附表6_T14\":\"2022-12-31\",\"附表6_BY14\":\"2037-03-31\",\"附表6_BQ15\":0,\"附表6_DT15\":0,\"附表6_DT14\":\"2048-12-31\",\"附表6_BP14\":\"2034-12-31\",\"附表6_DS14\":\"2048-09-30\",\"附表6_BP15\":0,\"附表6_DK15\":0,\"附表6_C14\":\"2018-09-30\",\"附表6_BH14\":\"2032-12-31\",\"附表6_DK14\":\"2046-09-30\",\"附表6_C15\":-3599.9999999999995,\"附表6_BH15\":0,\"附表6_DC15\":0,\"附表6_DC14\":\"2044-09-30\",\"附表6_CZ15\":0,\"附表6_AW14\":\"2030-03-31\",\"附表6_CZ14\":\"2043-12-31\",\"附表6_AW15\":0,\"附表6_CR15\":0,\"附表6_AJ14\":\"2026-12-31\",\"附表6_AJ15\":0,\"附表6_CM15\":0,\"附表6_CM14\":\"2040-09-30\",\"附表6_EH15\":0,\"附表6_AB14\":\"2024-12-31\",\"附表6_EH14\":\"2052-06-30\",\"附表6_AB15\":0,\"附表6_CE15\":0,\"附表6_CE14\":\"2038-09-30\",\"附表6_O14\":\"2021-09-30\",\"附表6_O15\":23.398202980143196,\"附表6_DW15\":0,\"附表6_W14\":\"2023-09-30\",\"附表6_BT14\":\"2035-12-31\",\"附表6_DW14\":\"2049-09-30\",\"附表6_W15\":58.43410557445873,\"附表6_BT15\":0,\"附表6_BK14\":\"2033-09-30\",\"附表6_BK15\":0,\"附表6_DN15\":0,\"附表6_DN14\":\"2047-06-30\",\"附表6_F15\":313.7453087697365,\"附表6_F14\":\"2019-06-30\",\"附表6_BC14\":\"2031-09-30\",\"附表6_BC15\":0,\"附表6_DF15\":0,\"附表6_DF14\":\"2045-06-30\",\"附表6_AZ14\":\"2030-12-31\",\"附表6_AZ15\":0,\"附表6_AR14\":\"2028-12-31\",\"附表6_AR15\":0,\"附表6_CU15\":0,\"附表6_CU14\":\"2042-09-30\",\"附表6_AI14\":\"2026-09-30\",\"附表6_CL14\":\"2040-06-30\",\"附表6_AI15\":0,\"附表6_CL15\":0,\"附表6_AA14\":\"2024-09-30\",\"附表6_CD14\":\"2038-06-30\",\"附表6_EG14\":\"2052-03-31\",\"附表6_AA15\":0,\"附表6_EG15\":0,\"附表6_CD15\":0,\"附表6_N15\":19.12284136531116,\"附表6_N14\":\"2021-06-30\",\"附表6_V15\":83.79514791115469,\"附表6_V14\":\"2023-06-30\",\"附表6_BS14\":\"2035-09-30\",\"附表6_BS15\":0,\"附表6_DV15\":0,\"附表6_DV14\":\"2049-06-30\",\"附表6_BJ14\":\"2033-06-30\",\"附表6_DM14\":\"2047-03-31\",\"附表6_BJ15\":0,\"附表6_DM15\":0,\"附表6_E14\":\"2019-03-31\",\"附表6_BB14\":\"2031-06-30\",\"附表6_DE14\":\"2045-03-31\",\"附表6_E15\":412.951245145548,\"附表6_BB15\":0,\"附表6_DE15\":0,\"附表6_AY14\":\"2030-09-30\",\"附表6_AY15\":0,\"附表6_AQ14\":\"2028-09-30\",\"附表6_CT14\":\"2042-06-30\",\"附表6_AQ15\":0,\"附表6_CT15\":0,\"附表6_AL15\":0,\"附表6_CO15\":0,\"附表6_Y15\":0,\"附表6_CO14\":\"2041-03-31\",\"附表6_AL14\":\"2027-06-30\",\"附表6_AD15\":0,\"附表6_CG15\":0,\"附表6_EJ15\":0,\"附表6_CG14\":\"2039-03-31\",\"附表6_EJ14\":\"2052-12-31\",\"附表6_AD14\":\"2025-06-30\",\"附表6_EB14\":\"2050-12-31\",\"附表6_I15\":-121.05826675055027,\"附表6_EB15\":0,\"附表6_Q14\":\"2022-03-31\",\"附表6_BV14\":\"2036-06-30\",\"附表6_DY14\":\"2050-03-31\",\"附表6_Q15\":46.49694960343629,\"附表6_BV15\":0,\"附表6_DY15\":0,\"附表6_Y14\":\"2024-03-31\",\"附表6_BM15\":0,\"附表6_DP15\":0,\"附表6_DP14\":\"2047-12-31\",\"附表6_BM14\":\"2034-03-31\",\"附表6_BE15\":0,\"附表6_DH15\":0,\"附表6_DH14\":\"2045-12-31\",\"附表6_H15\":215.33483712215752,\"附表6_H14\":\"2019-12-31\",\"附表6_BE14\":\"2032-03-31\",\"附表6_AT15\":0,\"附表6_CW15\":0,\"附表6_CW14\":\"2043-03-31\",\"附表6_AT14\":\"2029-06-30\",\"附表6_CN15\":0,\"附表6_AK14\":\"2027-03-31\",\"附表6_CN14\":\"2040-12-31\",\"附表6_AK15\":0,\"附表6_CF15\":0,\"附表6_EI14\":\"2052-09-30\",\"附表6_EI15\":0,\"附表6_AC14\":\"2025-03-31\",\"附表6_CF14\":\"2038-12-31\",\"附表6_AC15\":0,\"附表6_EA15\":0,\"附表6_EA14\":\"2050-09-30\",\"附表6_P15\":3091.444383677592,\"附表6_P14\":\"2021-12-31\",\"附表6_BU15\":0,\"附表6_DX15\":0,\"附表6_DX14\":\"2049-12-31\",\"附表6_X15\":13100.797111649872,\"附表6_X14\":\"2023-12-31\",\"附表6_BU14\":\"2036-03-31\",\"附表6_DO15\":0,\"附表6_BL14\":\"2033-12-31\",\"附表6_DO14\":\"2047-09-30\",\"附表6_BL15\":0,\"附表6_DG15\":0,\"附表6_G14\":\"2019-09-30\",\"附表6_BD14\":\"2031-12-31\",\"附表6_DG14\":\"2045-09-30\",\"附表6_G15\":414.5398393561424,\"附表6_BD15\":0,\"附表6_CV15\":0,\"附表6_AS14\":\"2029-03-31\",\"附表6_CV14\":\"2042-12-31\",\"附表6_AS15\":0,\"附表6_AN14\":\"2027-12-31\",\"附表6_AN15\":0,\"附表6_CQ15\":0,\"附表6_CQ14\":\"2041-09-30\",\"附表6_AF14\":\"2025-12-31\",\"附表6_AF15\":0,\"附表6_CI15\":0,\"附表6_CI14\":\"2039-09-30\",\"附表6_ED15\":0,\"附表6_K14\":\"2020-09-30\",\"附表6_CA15\":0,\"附表6_ED14\":\"2051-06-30\",\"附表6_K15\":1.1368683772161603E-13,\"附表6_CA14\":\"2037-09-30\",\"附表6_S14\":\"2022-09-30\",\"附表6_BX14\":\"2036-12-31\",\"附表6_S15\":55.00692414996797,\"附表6_BX15\":0,\"附表6_DS15\":0,\"附表6_BO14\":\"2034-09-30\",\"附表6_BO15\":0,\"附表6_DR15\":0,\"附表6_DR14\":\"2048-06-30\",\"附表6_B15\":-3800,\"附表6_B14\":\"2018-03-31\",\"附表6_BG14\":\"2032-09-30\",\"附表6_BG15\":0,\"附表6_DJ15\":0,\"附表6_DJ14\":\"2046-06-30\",\"附表6_DB15\":0,\"附表6_DB14\":\"2044-06-30\",\"附表6_AV14\":\"2029-12-31\",\"附表6_AV15\":0,\"附表6_CY15\":0,\"附表6_CY14\":\"2043-09-30\",\"附表6_Z15\":0,\"附表6_AM14\":\"2027-09-30\",\"附表6_CP14\":\"2041-06-30\",\"附表6_AM15\":0,\"附表6_Z14\":\"2024-06-30\",\"附表6_CP15\":0,\"附表6_AE14\":\"2025-09-30\",\"附表6_CH14\":\"2039-06-30\",\"附表6_EK14\":\"2053-03-31\",\"附表6_AE15\":0,\"附表6_EK15\":0,\"附表6_CH15\":0,\"附表6_J15\":-117.5002942242188,\"附表6_J14\":\"2020-06-30\",\"附表6_EC15\":0,\"附表6_EC14\":\"2051-03-31\",\"附表6_R15\":50.755627971937884,\"附表6_R14\":\"2022-06-30\",\"附表6_BW14\":\"2036-09-30\",\"附表6_BW15\":0,\"附表6_DZ15\":0,\"附表6_DZ14\":\"2050-06-30\",\"附表6_BN14\":\"2034-06-30\",\"附表6_DQ14\":\"2048-03-31\",\"附表6_BN15\":0,\"附表6_DQ15\":0,\"附表6_BF14\":\"2032-06-30\",\"附表6_DI14\":\"2046-03-31\",\"附表6_BF15\":0,\"附表6_DI15\":0,\"附表6_I14\":\"2020-03-31\",\"附表6_DA14\":\"2044-03-31\",\"附表6_DA15\":0,\"附表6_AU14\":\"2029-09-30\",\"附表6_CX14\":\"2043-06-30\",\"附表6_AU15\":0,\"附表6_CX15\":0}";
        env = JsonKit.parse(values, Map.class);
//        System.out.println(AviatorEvaluator.execute(exp, env));

    }

    @Test
    public void testXNPV() {
        String exp = "finance.xnpv(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)";
        assertEquals(20866.47602031540,
                     AviatorEvaluator.exec(exp, 0.09, -100000, 27500, 42500, 32500, 27500, "2008-1-1", "2008-3-1",
                                           "2008-10-30", "2009-2-15", "2009-4-1"));
    }

}
